{% set sumo_tz = salt['pillar.get']('sumologic:timezone', "America/Los_Angeles") %}
{% set f_sources = salt['pillar.get']('sumologic:file_sources', {}) %}
{% set s_sources = salt['pillar.get']('sumologic:script_sources') %}

{
  "api.version": "v1",
  "sources": [
    {% for sourcename,source in f_sources.iteritems() %}
     {
     "sourceType" : "LocalFile",
     "name": "{{ sourcename }}",
     "pathExpression": "{{ source["path"]}}",
     "category": "{{source["category"]}}",
     "hostName": "{{salt['grains.get']('id')}}",
     "useAutolineMatching": "{{source.get('useAutolineMatching', 'false')}}",
     "multilineProcessingEnabled": "{{source.get('multilineProcessingEnabled', 'false')}}",
     "automaticDateParsing": "{{source.get('automaticDateParsing', 'true')}}",
     "timeZone": "{{ sumo_tz }}",
     "forceTimeZone": false,
     "defaultDateFormat": "{{source.get('defaultDateFormat', 'dd/MMM/yyyy HH:mm:ss')}}",
     "filters": {{source.get('filters',[]}},
     "blacklist": {{source.get('blacklist',[]}}
     }{% if not loop.last %},{% endif %}
    {% endfor %}
    {% if s_sources %}
    ,
    {% for sourcename,source in s_sources.iteritems() %}
    {
    "sourceType" : "Script",
    "commands": {{ source.commands | json() }},
    "cronExpression": "{{ source.cronExpression}}",
    "workingDir": "/tmp",
    "timeout": 60,
    "name" : "{{ sourcename }}",
    "description" : "{{ source.description }}",
    "category" : "{{ source.category}}",
    "timeZone": "{{ sumo_tz }}",
    "automaticDateParsing": true,
    "multilineProcessingEnabled": true,
    "useAutolineMatching": true,
    "manualPrefixRegexp": "",
    "forceTimeZone": false,
    "defaultDateFormat": "dd/MMM/yyyy HH:mm:ss"
    }{% if not loop.last %},{% endif %}
    {% endfor %}
    {% endif %}
    ]
  }
